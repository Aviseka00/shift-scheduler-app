{% extends "base.html" %}
{% block content %}

<h2 class="fw-bold text-primary mb-3">My Schedule</h2>

<div class="card p-3 mb-3">
    <label class="form-label fw-semibold">Select Project</label>
    <select id="projectSelect" class="form-select" onchange="changeProject()">
        {% for p in projects %}
        <option value="{{ p._id }}" {% if selected_project == p._id %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
    </select>
</div>

<div class="card p-3">
    <h5 class="fw-bold mb-3">Team Calendar</h5>
    <div id="teamCalendar" style="min-height: 600px;"></div>
</div>

{% endblock %}

{% block scripts %}

<script>
function changeProject() {
    window.location.href = "/member/my-schedule?project_id=" + document.getElementById("projectSelect").value;
}

document.addEventListener("DOMContentLoaded", function () {

    const calendar = new FullCalendar.Calendar(
        document.getElementById("teamCalendar"),
        {
            initialView: window.innerWidth < 768 ? "dayGridMonth" : "timeGridWeek",
            height: "auto",
            nowIndicator: true,
            headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,timeGridWeek,timeGridDay"
            },

            eventSources: [{
                url: "/member/api/all_team_shifts",
                method: "GET"
            }],

            eventDidMount: function(info) {
                // NO IMAGES â€” No flickering
                if (info.event.extendedProps.tooltip) {
                    info.el.title = info.event.extendedProps.tooltip;
                }
            }
        }
    );

    calendar.render();
});
</script>

{% endblock %}
