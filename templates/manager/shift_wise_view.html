{% extends "base.html" %}
{% block content %}

<div class="animate-fade-in-up">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1" style="font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
        Shift-Wise Team View
      </h2>
      <p class="text-muted mb-0">View all team members grouped by shift code (A/B/C/G)</p>
    </div>
  </div>

  <!-- FILTERS -->
  <div class="glass-card p-4 mb-4">
    <form method="get" class="row g-3">
      <div class="col-md-4">
        <label class="form-label fw-bold">Select Date *</label>
        <input type="date" name="date" value="{{ selected_date }}" class="form-control" required min="{{ today_date }}">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">Filter by Project</label>
        <select name="project_id" class="form-select">
          <option value="">All Projects</option>
          {% for p in projects %}
          <option value="{{ p._id }}" {% if selected_project and selected_project == p._id %}selected{% endif %}>
            {{ p.name }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 d-flex align-items-end gap-2">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-filter me-1"></i> Apply Filters
        </button>
        <a href="/manager/shift-wise-view?date={{ selected_date }}" class="btn btn-outline-secondary">
          Clear Project
        </a>
        <a href="/manager/shift-wise-view?date={{ selected_date }}{% if selected_project %}&project_id={{ selected_project }}{% endif %}&sort={% if sort_alphabetical %}none{% else %}alphabetical{% endif %}" 
           class="btn btn-outline-info">
          <i class="fas fa-sort-alpha-down me-1"></i>
          {% if sort_alphabetical %}Default Order{% else %}Sort A-Z{% endif %}
        </a>
      </div>
    </form>
  </div>

  <!-- SUMMARY CARDS -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="glass-card p-3 text-center">
        <h6 class="text-muted mb-2">Total Members</h6>
        <h3 class="mb-0" style="color: #667eea;">{{ total_members }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="glass-card p-3 text-center" style="border-left: 4px solid #0d6efd;">
        <h6 class="text-muted mb-2">Shift A</h6>
        <h3 class="mb-0" style="color: #0d6efd;">{{ shift_counts.A }}</h3>
        <small class="text-muted">06:00 - 14:30</small>
      </div>
    </div>
    <div class="col-md-3">
      <div class="glass-card p-3 text-center" style="border-left: 4px solid #198754;">
        <h6 class="text-muted mb-2">Shift B</h6>
        <h3 class="mb-0" style="color: #198754;">{{ shift_counts.B }}</h3>
        <small class="text-muted">14:00 - 22:30</small>
      </div>
    </div>
    <div class="col-md-3">
      <div class="glass-card p-3 text-center" style="border-left: 4px solid #ffc107;">
        <h6 class="text-muted mb-2">Shift C</h6>
        <h3 class="mb-0" style="color: #ffc107;">{{ shift_counts.C }}</h3>
        <small class="text-muted">22:00 - 06:00</small>
      </div>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-md-3 offset-md-9">
      <div class="glass-card p-3 text-center" style="border-left: 4px solid #6f42c1;">
        <h6 class="text-muted mb-2">Shift G</h6>
        <h3 class="mb-0" style="color: #6f42c1;">{{ shift_counts.G }}</h3>
        <small class="text-muted">09:00 - 17:30</small>
      </div>
    </div>
  </div>

  <!-- SHIFT GROUPS -->
  <div class="row g-4">
    {% for shift_code in ['A', 'B', 'C', 'G'] %}
    {% set members = shift_groups[shift_code] %}
    <div class="col-md-6">
      <div class="glass-card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">
            <span class="badge 
              {% if shift_code == 'A' %}bg-primary
              {% elif shift_code == 'B' %}bg-success
              {% elif shift_code == 'C' %}bg-warning text-dark
              {% elif shift_code == 'G' %}bg-info text-dark
              {% endif %}" style="font-size: 1.2rem; padding: 0.5rem 1rem;">
              Shift {{ shift_code }}
            </span>
            <span class="ms-2 text-muted">({{ members|length }} member{{ 's' if members|length != 1 else '' }})</span>
          </h4>
          <small class="text-muted">
            {% if shift_code == 'A' %}06:00 - 14:30
            {% elif shift_code == 'B' %}14:00 - 22:30
            {% elif shift_code == 'C' %}22:00 - 06:00
            {% elif shift_code == 'G' %}09:00 - 17:30
            {% endif %}
          </small>
        </div>

        {% if members %}
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th style="width: 5%;">#</th>
                <th>Member Name</th>
                <th>Project</th>
                <th>Task</th>
              </tr>
            </thead>
            <tbody>
              {% for member in members %}
              <tr>
                <td><strong>{{ loop.index }}</strong></td>
                <td>
                  <div>
                    <strong>{{ member.user_name }}</strong>
                    <br>
                    <small class="text-muted">{{ member.user_email }}</small>
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary">{{ member.project_name }}</span>
                </td>
                <td>
                  <small class="text-muted">{{ member.task or '-' }}</small>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-user-slash fa-2x text-muted mb-2"></i>
          <p class="text-muted mb-0">No members assigned to Shift {{ shift_code }}</p>
        </div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- BACK BUTTON -->
  <div class="mt-4 text-center">
    <a href="/manager/manage-shifts" class="btn btn-outline-primary">
      <i class="fas fa-arrow-left me-2"></i>Back to Manage Shifts
    </a>
  </div>
</div>

{% endblock %}

