{% extends "base.html" %}

{% block content %}

<h2 class="fw-bold text-primary mb-3">Member Dashboard</h2>

<div class="card p-3 mb-4">
    <h5 class="fw-bold">My Upcoming Shifts</h5>

    {% if upcoming %}
    <ul class="list-group">
        {% for s in upcoming %}
        <li class="list-group-item">
            <strong>{{ s.date }}</strong> — {{ s.shift_code }} ({{ s.start_time }} to {{ s.end_time }})
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted">No upcoming shifts.</p>
    {% endif %}
</div>

<div class="card p-3">
    <h5 class="fw-bold">My Calendar</h5>
    <div id="personalCalendar" style="min-height: 600px;"></div>
</div>

{% endblock %}

{% block scripts %}

<script>
document.addEventListener("DOMContentLoaded", function () {

    const cal = new FullCalendar.Calendar(
        document.getElementById("personalCalendar"),
        {
            initialView: "dayGridMonth",
            height: "auto",
            nowIndicator: true,
            headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,timeGridWeek,timeGridDay"
            },

            eventSources: [{
                url: "/member/api/my_shifts",
                method: "GET"
            }],

            eventDidMount: function(info) {
                // No image injection → No flicker
                if (info.event.extendedProps.tooltip) {
                    info.el.title = info.event.extendedProps.tooltip;
                }
            }
        }
    );

    cal.render();
});
</script>

{% endblock %}
