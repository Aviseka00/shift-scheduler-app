{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h3>{{ project.name }}</h3>
    <p class="mb-1">{{ project.description }}</p>
    <p class="text-muted mb-0">
      <strong>Project Duration:</strong> 
      {% if project.start_date and project.end_date %}
        {{ project.start_date }} to {{ project.end_date }}
      {% else %}
        Not set
      {% endif %}
    </p>
  </div>
  {% if is_manager %}
  <div class="d-flex gap-2">
    <a href="{{ url_for('project.edit_project', project_id=project._id) }}" class="btn btn-primary"><i class="fas fa-edit me-2"></i>Edit Project</a>
    <form method="post" action="{{ url_for('project.delete_project', project_id=project._id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this project? This will also delete all associated tasks and unlink shifts. This action cannot be undone.');">
      <button type="submit" class="btn btn-danger"><i class="fas fa-trash me-2"></i>Delete Project</button>
    </form>
  </div>
  {% endif %}
</div>

<hr>

{% if is_manager %}
<a href="{{ url_for('project.add_task', project_id=project._id) }}" class="btn btn-secondary">Add Task</a>
<a href="{{ url_for('project.add_shift', project_id=project._id) }}" class="btn btn-warning">Add Shift</a>
{% endif %}

<h4 class="mt-4">Tasks</h4>
<table class="table table-sm">
  <tr>
    <th>Task</th>
    <th>Assigned To</th>
    <th>Due</th>
  </tr>
  {% for t in tasks %}
  <tr>
    <td>{{ t.task_name }}</td>
    <td>{{ users_map[t.assigned_to|string] }}</td>
    <td>{{ t.due_date }}</td>
  </tr>
  {% else %}
  <tr><td colspan="3" class="text-center">No tasks yet.</td></tr>
  {% endfor %}
</table>

<h4 class="mt-4">Shifts</h4>
<table class="table table-sm">
  <tr>
    <th>Date</th>
    <th>User</th>
    <th>Shift</th>
    <th>Time</th>
    <th>Task</th>
  </tr>
  {% for s in shifts %}
  <tr>
    <td>{{ s.date }}</td>
    <td>{{ users_map[s.user_id|string] }}</td>
    <td><span class="badge shift-badge-{{ s.shift_code }}">{{ s.shift_code }}</span></td>
    <td>{{ s.start_time }} - {{ s.end_time }}</td>
    <td>{{ s.task }}</td>
  </tr>
  {% else %}
  <tr><td colspan="5" class="text-center">No shifts yet.</td></tr>
  {% endfor %}
</table>

{% endblock %}
